<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview • envClean</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview">
<meta property="og:description" content="envClean">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">envClean</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/010_overview.html">Overview</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Acanthiza/envClean/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overview</h1>
                        <h4 data-toc-skip class="author">Department for
Environment and Water</h4>
                        <h4 data-toc-skip class="author">Nigel
Willoughby</h4>
            
            <h4 data-toc-skip class="date">Friday, 07 February,
2025</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Acanthiza/envClean/blob/HEAD/vignettes/010_overview.Rmd" class="external-link"><code>vignettes/010_overview.Rmd</code></a></small>
      <div class="hidden name"><code>010_overview.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span>  <span class="va">pacs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"knitr"</span></span>
<span>            , <span class="st">"envClean"</span></span>
<span>            , <span class="st">"envReport"</span></span>
<span>            , <span class="st">"envFunc"</span>, <span class="st">"fs"</span>, <span class="st">"purrr"</span></span>
<span>            , <span class="st">"dplyr"</span>, <span class="st">"sf"</span>, <span class="st">"tibble"</span></span>
<span>            , <span class="st">"tmap"</span>, <span class="st">"raster"</span>, <span class="st">"rstanarm"</span></span>
<span>            <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">walk</a></span><span class="op">(</span><span class="va">pacs</span></span>
<span>              , <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">.</span></span>
<span>                                                        , character.only <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                                                        , quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                                                <span class="op">)</span></span>
<span>              <span class="op">)</span></span>
<span></span>
<span>  <span class="co">#  Load data</span></span>
<span>  <span class="va">flor_all</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu">envClean</span><span class="fu">::</span><span class="va"><a href="../reference/flor_all.html">flor_all</a></span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># What crs to use for maps?</span></span>
<span>  <span class="va">use_crs</span> <span class="op">&lt;-</span> <span class="fl">3577</span> <span class="co"># actually an epsg code. see epsg.io</span></span>
<span>  </span>
<span>  <span class="co"># set area of interest coordinate reference system</span></span>
<span>  <span class="va">aoi</span> <span class="op">&lt;-</span> <span class="fu">envClean</span><span class="fu">::</span><span class="va"><a href="../reference/aoi.html">aoi</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">use_crs</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><code>envClean</code> is not on CRAN.</p>
<p>Install the development version from GitHub</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"acanthiza/envClean"</span><span class="op">)</span></span></code></pre></div>
<p>Load <code>envClean</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://acanthiza.github.io/envClean/" class="external-link">"envClean"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="workflow">Suggested workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>After many, many iterations, the following workflow has been found to
be ok. Only ok. There is no awesome when cleaning large, unstructured
data.</p>
<table style="width:100%;" class="table">
<caption>Suggested steps in the cleaning process</caption>
<colgroup>
<col width="14%">
<col width="79%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">clean</th>
<th align="left">desc</th>
<th align="right">order</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">all</td>
<td align="left">starting point</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">tem_range</td>
<td align="left">within a date range</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">tem_bin</td>
<td align="left">assigning dates to temporal bins</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">tem_rel</td>
<td align="left">temporal reliability</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">geo_range</td>
<td align="left">within a geographic area</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">geo_bin</td>
<td align="left">assigning locations to spatial bins</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">geo_rel</td>
<td align="left">spatial reliability</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">context</td>
<td align="left">define context</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">att</td>
<td align="left">select attributes</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">geo</td>
<td align="left">add geographic context (e.g. IBRA)</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">ann</td>
<td align="left">non-persistent taxa</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">taxa</td>
<td align="left">align taxonomy and resolve any taxonomic duplication
within bins</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">single</td>
<td align="left">singletons</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">out</td>
<td align="left">outliers</td>
<td align="right">13</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">NA values in important columns</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">effort</td>
<td align="left">context effort</td>
<td align="right">15</td>
</tr>
<tr class="odd">
<td align="left">prop</td>
<td align="left">proportion of sites</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">life</td>
<td align="left">as a byproduct of assigning all records of a taxa a
lifeform</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">cov</td>
<td align="left">as a byproduct of assigning all records of a taxa a
cover value</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">recent</td>
<td align="left">the most recent visit to a cell</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">lists</td>
<td align="left">add list length</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">filt_list_df</td>
<td align="left">filter occurrence data to a set of criteria</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">fst</td>
<td align="left">fix spatial taxonomy</td>
<td align="right">22</td>
</tr>
<tr class="even">
<td align="left">fbd</td>
<td align="left">filter by distribution</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">pres</td>
<td align="left">presences only</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="left">coord</td>
<td align="left">centroids of state, capital and institutions</td>
<td align="right">25</td>
</tr>
<tr class="odd">
<td align="left">ind</td>
<td align="left">indigenous species</td>
<td align="right">26</td>
</tr>
<tr class="even">
<td align="left">rm</td>
<td align="left">geographic reliability</td>
<td align="right">27</td>
</tr>
<tr class="odd">
<td align="left">include</td>
<td align="left">taxa with presences, reliable distributions, and/or mcp
around presences</td>
<td align="right">28</td>
</tr>
<tr class="even">
<td align="left">bin</td>
<td align="left">reduce to distinct rows</td>
<td align="right">29</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="key-concepts">Key concepts<a class="anchor" aria-label="anchor" href="#key-concepts"></a>
</h2>
<div class="section level3">
<h3 id="filtercleantidy">Filter/clean/tidy<a class="anchor" aria-label="anchor" href="#filtercleantidy"></a>
</h3>
<p><code>envClean</code>, helps with implementing:</p>
<ul>
<li>filtering: remove rows of a data frame. These may be entirely
legitimate observations but it is desirable to remove them for the
purposes of a downstream analysis. For example, a [context] with only
one (legitimate) record may not meet the expectations of an analysis
that within each [context] there is a list of taxa recorded.</li>
<li>cleaning: remove observations to reduce the risk that spurious
observations are included in downstream analysis. For example, two
different data sources may contain the same observation. Most analyses
will perform better when records duplicated within a context are
removed.</li>
<li>tidying: as per <a href="https://www.jstatsoft.org/article/view/v059i10" class="external-link">tidy data</a>
<span class="citation">(Wickham 2014)</span> where each variable is a
column and each observation is a unique row.</li>
</ul>
<p>In practice these tasks are often blurred within each of the
functions.</p>
<p>In general the process will be referred to as <em>cleaning</em>.</p>
</div>
<div class="section level3">
<h3 id="bins-for-sites-visits-records-taxa">Bins (for sites, visits, records, taxa)<a class="anchor" aria-label="anchor" href="#bins-for-sites-visits-records-taxa"></a>
</h3>
<p>Due to the loose definition of <a href="#bins">bins</a> (see below),
the definitions of site, visit, record and taxa can change through the
cleaning process.</p>
<ul>
<li>sites are spatial locations. they may be defined by latitude,
longitude, easting, northing and/or cell. These may be duplicated before
exclusive application of context. They are not necessarily defined by
all spatial concepts within context at all stages of the cleaning
process. In <code>env</code> spatial bins are usually set by
add_raster_cell.</li>
<li>visits are sites plus a time, such as year, month, day (or, even
hour). Again, until context is applied exclusively, these may be
duplicated. In <code>env</code> temporal bins are usually year, month,
or occasionally, day.</li>
<li>records are visits plus an observation to some level of the
taxonomic hierarchy (refered to simply as ‘taxa’)</li>
<li>taxa refers to some form of taxonomic entity. An entity may be
duplicated within a visit before taxonomy is resolved and context is
applied exclusively. In <code>env</code> taxonomic bins are usually set
by make_taxonomy(target_rank = “desired rank”) where ‘desired_rank’
could be, say, ‘species’, or, say, ‘subspecies’.</li>
</ul>
<p>Throughout the series of <code>env</code> packages the concept of
<em>context</em> is used extensively, and at least currently, somewhat
loosely. Context supplies the bins: spatial, temporal and taxonomic
bins.</p>
<p>With respect to ‘loosely’: context may be defined by, say,
<code>c("lat", "long", "cell", "year", "month")</code>. At various
stages through the cleaning process not every one of those variables may
be applicable. After running <code>add_raster_cell</code> (to assign a
spatial bin) the variable <code>lat</code> and <code>long</code> may be
removed (depending on the <code>add_xy</code> argument). However
<code>context</code> can still be used in full in cleaning steps (via
the consistent use of <code><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">tidyselect::any_of</a></code> in
<code>envClean</code> functions).</p>
<p>Note that <code>context</code> must be applied <em>exclusively</em>
at some point in the cleaning process (by, say,
<code>dplyr::distinct(across(any_of(context)))</code>). Until that point
extraneous fields/columns beyond <code>context</code> are maintained;
and no claim is made regarding the uniqueness of ‘records’ until this
step in the process.</p>
</div>
<div class="section level3">
<h3 id="summarising-the-cleaning-process">Summarising the cleaning process<a class="anchor" aria-label="anchor" href="#summarising-the-cleaning-process"></a>
</h3>
<p>There are some cleaning process summary functions. Taking advantage
of these requires:</p>
<ul>
<li>consistent naming with a prefix, default <code>bio_</code>
<ul>
<li>the suffix is a short name for that step in the cleaning process.
e.g. <code>bio_taxa</code> would be the object created when applying the
taxonomic bins, and <code>bio_geo_bin</code> is the object created when
applying geogrphic bins</li>
<li>see envClean::luclean for the suffixes/short names (in the
<code>clean</code> column)</li>
</ul>
</li>
<li>addition of a ctime (creation time) attribute, probably using
envFunc::add_time_stamp()</li>
</ul>
<p>The function clean_summary() then prepares information, based on the
objects creating through the cleaning process, that can be used in
summary reports. clean_summary() also, optionally (with default TRUE)
saves the start and end objects from the cleaning process.</p>
<p>cleaning_text() prepares text, based on a cleaning summary, that can
be used directly in .Rmd.</p>
<p>There are also small .Rmd files in <code>/inst</code> that match the
suffix for each step. Looping through these child files from a main .Rmd
provides the structure for the output report.</p>
</div>
<div class="section level3">
<h3 id="coordinate-reference-systems">Coordinate reference systems<a class="anchor" aria-label="anchor" href="#coordinate-reference-systems"></a>
</h3>
<p>There are two (possibly three) main coordinate reference systems
(crs) to worry about:</p>
<ol style="list-style-type: decimal">
<li>the crs for the original records. If these are in decimal degrees,
using <a href="https://epsg.io/" class="external-link">epsg</a> = <a href="https://epsg.io/4283" class="external-link">4283</a> is likely to return the correct
crs.</li>
<li>the crs you’d like to use for most spatial data. Set here (in setup
chunk) to <code>use_crs</code> = 3577. It is likely that a projected crs
will work best, particularly for buffering, filtering etc.</li>
<li>the crs for any other spatial data imported to help with cleaning.
Try using
<code>sf::st_read("random_shape_file.shp") %&gt;% sf::st_tranform(crs = use_crs)</code>
to deal with this.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="import">Import<a class="anchor" aria-label="anchor" href="#import"></a>
</h2>
<p>Querying and uniting disparate data sources into a single data set is
a challenge in its own right. See <a href="https://github.com/Acanthiza/envImport" class="external-link">envImport</a> for tools to
assist there. Once you’ve imported and combined all your data, read
on.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-JSSv059i10" class="csl-entry">
Wickham, Hadley. 2014. <span>“Tidy Data.”</span> <em>Journal of
Statistical Software</em> 59 (10): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10" class="external-link">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nigel Willoughby, Joel Allan.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
